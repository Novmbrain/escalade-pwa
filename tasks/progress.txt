## Ralph Loop Progress

### Iteration 1 — 2026-02-06
**Task**: PWA-app-bwi.1 (US-001): 删除岩面 API 级联清除 topoLine
**Status**: COMPLETED
**Changes**:
- Modified `src/app/api/faces/route.ts` line 240: added `topoLine: ''` to `$unset` operator
- When a face image is deleted, associated routes now have both `faceId` and `topoLine` cleared
**Verification**:
- TypeScript: PASS (npx tsc --noEmit)
- ESLint: PASS (no new errors introduced)
- Tests: PASS (52 files, 693 tests all passing)

### Iteration 2 (Ralph Loop 1) — 2026-02-06
**Task**: PWA-app-bwi.2 (US-002): 上传 API 支持可选清除 topoLine
**Status**: COMPLETED
**Changes**:
- Modified `src/app/api/upload/route.ts`:
  - Added `getDatabase` import from `@/lib/db`
  - Read optional `clearTopoLines` FormData parameter
  - After successful upload, if `clearTopoLines === 'true'` and faceId exists, clear topoLine on matching routes
  - Added `topoLinesCleared` count to response JSON and log metadata
**Verification**:
- TypeScript: PASS
- ESLint: PASS
- Tests: PASS (52 files, 693 tests all passing)
